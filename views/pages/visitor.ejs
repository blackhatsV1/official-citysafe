<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('../partials/head'); %>
    <script>
      const apiKey = "<%= apiKey %>";
      window.skipAutoLocation = true;
    </script>
    <script src="/js/script.js"></script>
    <style>
      #weather-map,
      #map {
        height: 350px;
        width: 100%;
      }
    </style>
</head>

<body class="bg-dark text-white">
  <%- include('../partials/page-start'); %>
  <div class="container-fluid position-relative d-flex p-0">
    <%- include('../partials/spinner'); %>
      <%- include('../partials/visitor-sidebar'); %>

        <div class="content">
          <%- include('../partials/visitor-navbar'); %>

            <!-- Hero Section -->
            <div class="container-fluid pt-4 px-4">
              <div class="card p-5 text-center shadow-sm overflow-hidden position-relative">
                <div class="position-absolute top-0 start-0 w-100 h-100 opacity-05"
                  style="background: url('https://www.transparenttextures.com/patterns/cubes.png'); z-index: 0;"></div>
                <div class="position-relative" style="z-index: 1;">
                  <span class="badge bg-indigo-soft text-indigo mb-3 px-3 py-2 rounded-pill fw-bold text-uppercase"
                    style="font-size: 0.7rem; letter-spacing: 0.1em;">Standard Public Access</span>
                  <h2 class="display-6 fw-800 text-head mb-3">Urban Safety Intelligence Hub</h2>
                  <p class="text-muted mx-auto mb-4" style="max-width: 600px;">
                    Access real-time environmental data, emergency alerts, and community response coordinates. Join the
                    network for full operational command.
                  </p>
                  <div class="d-flex gap-3 justify-content-center">
                    <a href="/login" class="btn btn-primary px-4 py-2 fw-bold shadow-sm">LOG IN TO DASHBOARD</a>
                    <a href="/register" class="btn btn-outline-secondary px-4 py-2 fw-bold">REGISTER ACCOUNT</a>
                  </div>
                </div>
              </div>
            </div>

            <!-- Intelligence Grid -->
            <div class="container-fluid pt-4 px-4">
              <div class="row g-4">
                <!-- Weather Radar -->
                <div class="col-lg-4">
                  <div class="card h-100 p-4 shadow-sm border-0">
                    <div class="d-flex align-items-center justify-content-between mb-3">
                      <div>
                        <h6 class="mb-0 fw-bold text-head text-uppercase small">Live Weather Radar</h6>
                        <small class="text-muted">Satellite Data Stream</small>
                      </div>
                      <div class="bg-indigo-soft p-2 rounded-md">
                        <i class="fa fa-satellite-dish text-indigo"></i>
                      </div>
                    </div>
                    <div id="weather-map" class="shadow-inner"></div>
                    <div class="mt-3 d-flex align-items-center gap-2">
                      <span class="badge bg-success-soft text-success p-1 rounded-circle"
                        style="width: 8px; height: 8px;"></span>
                      <small class="text-muted small">Live Radar Active</small>
                    </div>
                  </div>
                </div>

                <!-- Atmospheric Analytics -->
                <div class="col-lg-4">
                  <div class="card h-100 p-4 shadow-sm border-0">
                    <div class="d-flex align-items-center justify-content-between mb-4">
                      <div>
                        <h6 class="mb-0 fw-bold text-head text-uppercase small">Atmospheric Data</h6>
                        <small class="text-muted">Sensor Node Feedback</small>
                      </div>
                      <div class="bg-info-soft p-2 rounded-md">
                        <i class="fa fa-cloud text-info"></i>
                      </div>
                    </div>

                    <div class="p-3 bg-dark text-white rounded mb-4 border-light shadow-sm">
                      <div class="d-flex align-items-center gap-2 mb-2">
                        <i class="fa fa-location-dot text-primary small"></i>
                        <span id="address" class="small fw-bold text-primary text-truncate d-block">Scanning...</span>
                      </div>
                      <span id="coords" class="family-monospace text-muted" style="font-size: 0.7rem;">Waiting for
                        signal...</span>
                    </div>

                    <div id="weather-info" class="flex-grow-1">
                      <div class="text-center py-5 opacity-50">
                        <div class="spinner-border spinner-border-sm text-primary mb-2" role="status"></div>
                        <p class="small mb-0">Polling Atmospheric Sensors...</p>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Operations Map -->
                <div class="col-lg-4">
                  <div class="card h-100 p-4 shadow-sm border-0">
                    <div class="d-flex align-items-center justify-content-between mb-3">
                      <div>
                        <h6 class="mb-0 fw-bold text-head text-uppercase small">Live Operations Map</h6>
                        <small class="text-muted">Field Station Metadata</small>
                      </div>
                      <div class="bg-danger-soft p-2 rounded-md">
                        <i class="fa fa-map-marked text-danger"></i>
                      </div>
                    </div>
                    <div id="map" class="shadow-inner"></div>
                    <%- include('../partials/selectloc-visitor'); %>
                      <div class="mt-3">
                        <small class="text-muted d-block" style="font-size: 0.7rem;">* Register for full incident
                          reporting features.</small>
                      </div>
                  </div>
                </div>
              </div>
            </div>

            <%- include('../partials/page-end'); %>
            <%- include('../partials/footer'); %>
        </div>

        <!-- Scroll to Top -->
        <a href="#" class="btn btn-primary btn-md-square back-to-top rounded-circle shadow-lg"><i
            class="bi bi-arrow-up"></i></a>
  </div>

  <script>
    // Trigger resize on map load to fix Leaflet gray tiles
    window.addEventListener('load', () => {
      setTimeout(() => {
        window.dispatchEvent(new Event('resize'));
      }, 1000);
    });
  </script>
</body>

</html>